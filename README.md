# Installation Instructions
_For WordPress users_

## Database Configuration
1. Create a new Empty database schema for the GeoIP Tables on the host where WordPress is running, with its own username, initially with remote access granted.
2. Inserts the Server credentials and database information into a new answers file for NRODbGen
3. Run the NRODbGen tool to populate the geoip table on the remote host with the latest IP allocation data from global NROs.
4. Create a copy of the database template file database.sql and customize the table prefixes to your needs.
5. Execute the SQL File on the remote database schema to create the new empty table structures for ipfilter.
6. Create a copy of the filter generation template file geoip-2-filter.sql and customize it to your needs.
7. Execute the filter generation file on the remote database schema to generate the filtering rules for IPFilter
8. Export the resulting table to a new SQL file, and wrap the entries around INSERT statements into the **ipentry** table on the remote database schema.


## Administration interface
1. Upload the management plugin rz-ipfilter-manager zip file into your Wordpress installation via the Add Plugin menu on the Administration Dashboard.
2. Activate the uploaded plugin.
3. Under the new IPFilter tab on the sidebar for the Administration Dashboard of Wordpress, select the Settings submenu, and update the database settings to
the new Database schema created on the previous step. Save the settings.
4. Browse the IPFilter and Top Entries submenus and ensure that no connection errors appear when clicking on Refresh.

## Driver installation
1. Customize the ipfilter firewall driver configuration file located at ipfilter/ipfilter/config.php to match your server settings. If a preppend file is already defined
in the php.ini settings, set the existing entry under the RZIPF_PHP_NEXTFILE definition. If no file is currently set, leave the definition set to an empty string.
2. Upload via FTP the ipfilter firewall driver located at the ipfilter directory to the root of your web server. Upload the contents of the directory and not the directory itself.
 Dont upload any .SQL file and ignore debug.php file. The file filter.php must be located at the root of the web server public directory.
3. Set the **auto_prepend_file** PHP variable inside your web server (by using php.ini) and point it to the full path of the **filter.php** file uploaded to the server.
4. Check that everything is properly configured and no PHP errors appear on page output during normal browsing.


## Validate configuration
1. No PHP output must be generated by the filtering driver during normal browsing.
2. Ensure that the "X-RZ-Floodgate" header is present on every HTTP response from the server. A value of 0 means that the current IP is allowed, a value of 1 means its filtered.
This header could be ommited from the response if the Wordpress engine clears the Headers structure after loading, to avoid this, make sure to test its presence by browsing
to an static resource like an image, css script, etc.
3. Ensure that your browsing IP is present on the cache table for ipfilter. Every unique visitor must be listed on this table, and a value on the **filtered** column indicates if
the browsing address is filtered by the driver or not.
4. If another auto_prepend_file was present on the PHP configuration before installing the IPFilter driver, check that chainloading workds by checking if its 
execution still happens after the driver runs.
